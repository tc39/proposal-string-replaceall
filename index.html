<!doctype html>
<head><meta charset="utf-8">
<title>String.prototype.replaceAll</title><script type="application/json" id="menu-search-biblio">[{"type":"op","aoid":"StringIndexOf","refId":"sec-stringindexof","location":"","referencingIds":[],"key":"StringIndexOf"},{"type":"clause","id":"sec-stringindexof","aoid":"StringIndexOf","title":"Static Semantics: StringIndexOf ( string, searchValue, fromIndex )","titleHTML":"Static Semantics: StringIndexOf ( <var>string</var>, <var>searchValue</var>, <var>fromIndex</var> )","number":"1","namespace":"https://tc39.es/proposal-string-replace-all/","location":"","referencingIds":["_ref_14","_ref_15","_ref_34"],"key":"Static Semantics: StringIndexOf ( string, searchValue, fromIndex )"},{"type":"clause","id":"sec-string.prototype.replaceall","aoid":null,"title":"String.prototype.replaceAll ( searchValue, replaceValue )","titleHTML":"String.prototype.replaceAll ( <var>searchValue</var>, <var>replaceValue</var> )","number":"2","namespace":"https://tc39.es/proposal-string-replace-all/","location":"","referencingIds":[],"key":"String.prototype.replaceAll ( searchValue, replaceValue )"},{"type":"clause","id":"sec-string.prototype.matchall","aoid":null,"title":"String.prototype.matchAll ( regexp )","titleHTML":"String.prototype.matchAll ( <var>regexp</var> )","number":"3","namespace":"https://tc39.es/proposal-string-replace-all/","location":"","referencingIds":[],"key":"String.prototype.matchAll ( regexp )"},{"type":"clause","id":"sec-string.prototype.indexof","aoid":null,"title":"String.prototype.indexOf ( searchString [ , position ] )","titleHTML":"String.prototype.indexOf ( <var>searchString</var> [ , <var>position</var> ] )","number":"4","namespace":"https://tc39.es/proposal-string-replace-all/","location":"","referencingIds":[],"key":"String.prototype.indexOf ( searchString [ , position ] )"}]</script></head><body><div id="menu-toggle">☰</div><div id="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins</div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-stringindexof" title="Static Semantics: StringIndexOf ( string, searchValue, fromIndex )"><span class="secnum">1</span> SS: StringIndexOf ( <var>string</var>, <var>searchValue</var>, <var>fromIndex</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-string.prototype.replaceall" title="String.prototype.replaceAll ( searchValue, replaceValue )"><span class="secnum">2</span> String.prototype.replaceAll ( <var>searchValue</var>, <var>replaceValue</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-string.prototype.matchall" title="String.prototype.matchAll ( regexp )"><span class="secnum">3</span> String.prototype.matchAll ( <var>regexp</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-string.prototype.indexof" title="String.prototype.indexOf ( searchString [ , position ] )"><span class="secnum">4</span> String.prototype.indexOf ( <var>searchString</var> [ , <var>position</var> ] )</a></li></ol></div></div><div id="spec-container"><h1 class="version first">Stage 4 Draft / June 29, 2020</h1><h1 class="title">String.prototype.replaceAll</h1>
<script src="ecmarkup.js" defer=""></script>
<link rel="stylesheet" href="ecmarkup.css">
<style>
  ins.block {
    font-weight: bold;
    font-style: italic;
  }
  hr {
    height: 0.25em;
    background: #ccc;
    border: 0;
    margin: 2em 0;
  }
</style>

<emu-clause id="sec-stringindexof" aoid="StringIndexOf">
  <h1><span class="secnum">1</span> Static Semantics: StringIndexOf ( <var>string</var>, <var>searchValue</var>, <var>fromIndex</var> )</h1>
  <p>The abstract operation StringIndexOf takes arguments <var>string</var> (a String), <var>searchValue</var> (a String), and <var>fromIndex</var> (a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref>). It performs the following steps when called:</p>
  <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="Type" id="_ref_0"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>string</var>) is String.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="Type" id="_ref_1"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>searchValue</var>) is String.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: !&nbsp;<emu-xref aoid="IsNonNegativeInteger" id="_ref_2"><a href="https://tc39.es/ecma262/#sec-isnonnegativeinteger">IsNonNegativeInteger</a></emu-xref>(<var>fromIndex</var>) is <emu-val>true</emu-val>.</li><li>Let <var>len</var> be the length of <var>string</var>.</li><li>If <var>searchValue</var> is the empty String, and <var>fromIndex</var> ≤ <var>len</var>, return <var>fromIndex</var>.</li><li>Let <var>searchLen</var> be the length of <var>searchValue</var>.</li><li>If there exists any <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref> <var>k</var> such that <var>fromIndex</var> ≤ <var>k</var> ≤ <var>len</var> - <var>searchLen</var> and for all nonnegative integers <var>j</var> less than <var>searchLen</var>, the code unit at index <var>k</var> + <var>j</var> within <var>string</var> is the same as the code unit at index <var>j</var> within <var>searchValue</var>, let <var>pos</var> be the smallest (closest to <emu-val>-∞</emu-val>) such <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref>. Otherwise, let <var>pos</var> be -1.</li><li>Return <var>pos</var>.</li></ol></emu-alg>
  <emu-note><span class="note">Note 1</span><div class="note-contents">
    <p>If <var>searchValue</var> is empty and <var>fromIndex</var> is less than or equal to the length of <var>string</var>, this algorithm returns <var>fromIndex</var>. An empty <var>searchValue</var> is effectively found at every position within a string, including after the last code unit.</p>
  </div></emu-note>
  <emu-note><span class="note">Note 2</span><div class="note-contents">
    <p>The above algorithm accepts out-of-bounds <var>fromIndex</var> values (where <var>fromIndex</var> ≥ the length of <var>string</var>).</p>
  </div></emu-note>
</emu-clause>

<emu-clause id="sec-string.prototype.replaceall">
  <h1><span class="secnum">2</span> String.prototype.replaceAll ( <var>searchValue</var>, <var>replaceValue</var> )</h1>
  <p>When the <code>replaceAll</code> method is called with arguments <var>searchValue</var> and <var>replaceValue</var>, the following steps are taken:</p>
  <emu-alg><ol><li>Let <var>O</var> be ?&nbsp;<emu-xref aoid="RequireObjectCoercible" id="_ref_3"><a href="https://tc39.es/ecma262/#sec-requireobjectcoercible">RequireObjectCoercible</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <var>searchValue</var> is neither <emu-val>undefined</emu-val> nor <emu-val>null</emu-val>, then<ol><li>Let <var>isRegExp</var> be ?&nbsp;<emu-xref aoid="IsRegExp" id="_ref_4"><a href="https://tc39.es/ecma262/#sec-isregexp">IsRegExp</a></emu-xref>(<var>searchValue</var>).</li><li>If <var>isRegExp</var> is true, then<ol><li>Let <var>flags</var> be ?&nbsp;<emu-xref aoid="Get" id="_ref_5"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>searchValue</var>, <emu-val>"flags"</emu-val>).</li><li>Perform ?&nbsp;<emu-xref aoid="RequireObjectCoercible" id="_ref_6"><a href="https://tc39.es/ecma262/#sec-requireobjectcoercible">RequireObjectCoercible</a></emu-xref>(<var>flags</var>).</li><li>If ?&nbsp;<emu-xref aoid="ToString" id="_ref_7"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>flags</var>) does not contain <emu-val>"g"</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li></ol></li><li>Let <var>replacer</var> be ?&nbsp;<emu-xref aoid="GetMethod" id="_ref_8"><a href="https://tc39.es/ecma262/#sec-getmethod">GetMethod</a></emu-xref>(<var>searchValue</var>, @@replace).</li><li>If <var>replacer</var> is not <emu-val>undefined</emu-val>, then<ol><li>Return ?&nbsp;<emu-xref aoid="Call" id="_ref_9"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>replacer</var>, <var>searchValue</var>, « <var>O</var>, <var>replaceValue</var> »).</li></ol></li></ol></li><li>Let <var>string</var> be ?&nbsp;<emu-xref aoid="ToString" id="_ref_10"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>O</var>).</li><li>Let <var>searchString</var> be ?&nbsp;<emu-xref aoid="ToString" id="_ref_11"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>searchValue</var>).</li><li>Let <var>functionalReplace</var> be <emu-xref aoid="IsCallable" id="_ref_12"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>replaceValue</var>).</li><li>If <var>functionalReplace</var> is <emu-val>false</emu-val>, then<ol><li>Set <var>replaceValue</var> to ?&nbsp;<emu-xref aoid="ToString" id="_ref_13"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>replaceValue</var>).
    <!-- Collect all matches: --></li></ol></li><li>Let <var>searchLength</var> be the length of <var>searchString</var>.</li><li>Let <var>advanceBy</var> be <emu-xref aoid="max"><a href="https://tc39.es/ecma262/#eqn-max">max</a></emu-xref>(1, <var>searchLength</var>).</li><li>Let <var>matchPositions</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>position</var> be !&nbsp;<emu-xref aoid="StringIndexOf" id="_ref_14"><a href="#sec-stringindexof">StringIndexOf</a></emu-xref>(<var>string</var>, <var>searchString</var>, 0).</li><li>Repeat, while <var>position</var> is not -1,<ol><li>Append <var>position</var> to the end of <var>matchPositions</var>.</li><li>Set <var>position</var> to !&nbsp;<emu-xref aoid="StringIndexOf" id="_ref_15"><a href="#sec-stringindexof">StringIndexOf</a></emu-xref>(<var>string</var>, <var>searchString</var>, <var>position</var> + <var>advanceBy</var>).
    <!-- Apply replacements: --></li></ol></li><li>Let <var>endOfLastMatch</var> be 0.</li><li>Let <var>result</var> be the empty String value.</li><li>For each <var>position</var> in <var>matchPositions</var>, do<ol><li>If <var>functionalReplace</var> is <emu-val>true</emu-val>, then<ol><li>Let <var>replacement</var> be ?&nbsp;<emu-xref aoid="ToString" id="_ref_16"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(? <emu-xref aoid="Call" id="_ref_17"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>replaceValue</var>, <emu-val>undefined</emu-val>, « <var>searchString</var>, <var>position</var>, <var>string</var> »)).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="Type" id="_ref_18"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>replaceValue</var>) is String.</li><li>Let <var>captures</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>replacement</var> be <emu-xref aoid="GetSubstitution" id="_ref_19"><a href="https://tc39.es/ecma262/#sec-getsubstitution">GetSubstitution</a></emu-xref>(<var>searchString</var>, <var>string</var>, <var>position</var>, <var>captures</var>, <emu-val>undefined</emu-val>, <var>replaceValue</var>).</li></ol></li><li>Let <var>stringSlice</var> be the substring of <var>string</var> consisting of the code units from <var>endOfLastMatch</var> (inclusive) up to <var>position</var> (exclusive).</li><li>Set <var>result</var> to the <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">string-concatenation</a></emu-xref> of <var>result</var>, <var>stringSlice</var>, and <var>replacement</var>.</li><li>Set <var>endOfLastMatch</var> to <var>position</var> + <var>searchLength</var>.</li></ol></li><li>If <var>endOfLastMatch</var> &lt; the length of <var>string</var>, then<ol><li>Set <var>result</var> to the <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">string-concatenation</a></emu-xref> of <var>result</var> and the substring of <var>string</var> consisting of the code units from <var>endOfLastMatch</var> (inclusive) up through the final code unit of <var>string</var> (inclusive).</li></ol></li><li>Return <var>result</var>.</li></ol></emu-alg>
</emu-clause>

<!-- Note: the changes to String.prototype.matchAll have already been merged upstream here: https://github.com/tc39/ecma262/pull/1716 -->
<emu-clause id="sec-string.prototype.matchall">
  <h1><span class="secnum">3</span> String.prototype.matchAll ( <var>regexp</var> )</h1>
  <p>Performs a regular expression match of the String representing the <emu-val>this</emu-val> value against <var>regexp</var> and returns an iterator. Each iteration result's value is an Array object containing the results of the match, or <emu-val>null</emu-val> if the String did not match.</p>
  <p>When the <code>matchAll</code> method is called, the following steps are taken:</p>
  <emu-alg><ol><li>Let <var>O</var> be ?&nbsp;<emu-xref aoid="RequireObjectCoercible" id="_ref_20"><a href="https://tc39.es/ecma262/#sec-requireobjectcoercible">RequireObjectCoercible</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <var>regexp</var> is neither <emu-val>undefined</emu-val> nor <emu-val>null</emu-val>, then<ol><li><ins>Let <var>isRegExp</var> be ?&nbsp;<emu-xref aoid="IsRegExp" id="_ref_21"><a href="https://tc39.es/ecma262/#sec-isregexp">IsRegExp</a></emu-xref>(<var>regexp</var>).</ins></li><li><ins>If <var>isRegExp</var> is <emu-val>true</emu-val>, then</ins><ol><li><ins>Let <var>flags</var> be ?&nbsp;<emu-xref aoid="Get" id="_ref_22"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>regexp</var>, <emu-val>"flags"</emu-val>).</ins></li><li><ins>Perform ?&nbsp;<emu-xref aoid="RequireObjectCoercible" id="_ref_23"><a href="https://tc39.es/ecma262/#sec-requireobjectcoercible">RequireObjectCoercible</a></emu-xref>(<var>flags</var>).</ins></li><li><ins>If ?&nbsp;<emu-xref aoid="ToString" id="_ref_24"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>flags</var>) does not contain <emu-val>"g"</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</ins></li></ol></li><li>Let <var>matcher</var> be ?&nbsp;<emu-xref aoid="GetMethod" id="_ref_25"><a href="https://tc39.es/ecma262/#sec-getmethod">GetMethod</a></emu-xref>(<var>regexp</var>, @@matchAll).</li><li>If <var>matcher</var> is not <emu-val>undefined</emu-val>, then<ol><li>Return ?&nbsp;<emu-xref aoid="Call" id="_ref_26"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>matcher</var>, <var>regexp</var>, « <var>O</var> »).</li></ol></li></ol></li><li>Let <var>S</var> be ?&nbsp;<emu-xref aoid="ToString" id="_ref_27"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>O</var>).</li><li>Let <var>rx</var> be ?&nbsp;<emu-xref aoid="RegExpCreate" id="_ref_28"><a href="https://tc39.es/ecma262/#sec-regexpcreate">RegExpCreate</a></emu-xref>(<var>regexp</var>, <code>"g"</code>).</li><li>Return ?&nbsp;<emu-xref aoid="Invoke" id="_ref_29"><a href="https://tc39.es/ecma262/#sec-invoke">Invoke</a></emu-xref>(<var>rx</var>, @@matchAll, « <var>S</var> »).</li></ol></emu-alg>
  <emu-note><span class="note">Note 1</span><div class="note-contents">The <code>matchAll</code> function is intentionally generic, it does not require that its <emu-val>this</emu-val> value be a String object. Therefore, it can be transferred to other kinds of objects for use as a method.</div></emu-note>
  <emu-note><span class="note">Note 2</span><div class="note-contents">Similarly to <code>String.prototype.split</code>, <code>String.prototype.matchAll</code> is designed to typically act without mutating its inputs.</div></emu-note>
</emu-clause>

<emu-clause id="sec-string.prototype.indexof">
  <h1><span class="secnum">4</span> String.prototype.indexOf ( <var>searchString</var> [ , <var>position</var> ] )</h1>
  <emu-note><span class="note">Note 1</span><div class="note-contents">
    <p>If <var>searchString</var> appears as a substring of the result of converting this object to a String, at one or more indices that are greater than or equal to <var>position</var>, then the smallest such index is returned; otherwise, -1 is returned. If <var>position</var> is <emu-val>undefined</emu-val>, 0 is assumed, so as to search all of the String.</p>
  </div></emu-note>
  <p>The <code>indexOf</code> method takes two arguments, <var>searchString</var> and <var>position</var>, and performs the following steps:</p>
  <emu-alg><ol><li>Let <var>O</var> be ?&nbsp;<emu-xref aoid="RequireObjectCoercible" id="_ref_30"><a href="https://tc39.es/ecma262/#sec-requireobjectcoercible">RequireObjectCoercible</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>Let <var>S</var> be ?&nbsp;<emu-xref aoid="ToString" id="_ref_31"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>O</var>).</li><li>Let <var>searchStr</var> be ?&nbsp;<emu-xref aoid="ToString" id="_ref_32"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<var>searchString</var>).</li><li>Let <var>pos</var> be ?&nbsp;<emu-xref aoid="ToInteger" id="_ref_33"><a href="https://tc39.es/ecma262/#sec-tointeger">ToInteger</a></emu-xref>(<var>position</var>).</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: If <var>position</var> is <emu-val>undefined</emu-val>, then <var>pos</var> is 0.</li><li>Let <var>len</var> be the length of <var>S</var>.</li><li>Let <var>start</var> be <emu-xref aoid="min"><a href="https://tc39.es/ecma262/#eqn-min">min</a></emu-xref>(<emu-xref aoid="max"><a href="https://tc39.es/ecma262/#eqn-max">max</a></emu-xref>(<var>pos</var>, 0), <var>len</var>).</li><li>Let <var>searchLen</var> be the length of <var>searchStr</var>.</li><li><del>Return the smallest possible <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref> <var>k</var> not smaller than <var>start</var> such that <var>k</var> + <var>searchLen</var> is not greater than <var>len</var>, and for all nonnegative integers <var>j</var> less than <var>searchLen</var>, the code unit at index <var>k</var> + <var>j</var> within <var>S</var> is the same as the code unit at index <var>j</var> within <var>searchStr</var>; but if there is no such <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref> <var>k</var>, return the value -1.</del></li><li><ins>Let <var>index</var> be !&nbsp;<emu-xref aoid="StringIndexOf" id="_ref_34"><a href="#sec-stringindexof">StringIndexOf</a></emu-xref>(<var>S</var>, <var>searchStr</var>, <var>start</var>).</ins></li><li><ins>Return <var>index</var>.</ins></li></ol></emu-alg>
  <emu-note><span class="note">Note 2</span><div class="note-contents">
    <p>The <code>indexOf</code> function is intentionally generic; it does not require that its <emu-val>this</emu-val> value be a String object. Therefore, it can be transferred to other kinds of objects for use as a method.</p>
  </div></emu-note>
</emu-clause>
</div></body>